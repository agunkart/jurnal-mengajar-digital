<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Jurnal Mengajar Digital (JUMADI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // Ikon SVG untuk digunakan dalam aplikasi
        const icons = {
            home: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>,
            plus: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            book: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>,
            users: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>,
            school: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 22h16"/><path d="M2 10l10-7l10 7"/><path d="M6 10v12h4v-8h4v8h4V10L12 3z"/></svg>,
            fileText: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>,
            settings: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            logout: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>,
            trash: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            edit: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
            x: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            search: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            eye: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>,
        };

        // Custom Hook untuk menyinkronkan state dengan localStorage
        function useLocalStorage(key, initialValue) {
            const [storedValue, setStoredValue] = React.useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.log(error);
                    return initialValue;
                }
            });

            const setValue = (value) => {
                try {
                    const valueToStore = value instanceof Function ? value(storedValue) : value;
                    setStoredValue(valueToStore);
                    window.localStorage.setItem(key, JSON.stringify(valueToStore));
                } catch (error) {
                    console.log(error);
                }
            };

            return [storedValue, setValue];
        }
        
        // Komponen Utama Aplikasi
        function App() {
            const [isAuthenticated, setIsAuthenticated] = useLocalStorage('jumadiAuth', false);
            const [credentials, setCredentials] = useLocalStorage('jumadiCredentials', { username: 'admin', password: '12345'});
            const [page, setPage] = React.useState('dashboard');
            const [journals, setJournals] = useLocalStorage('teachingJournals', []);
            const [students, setStudents] = useLocalStorage('studentDatabase', []);
            const [schoolData, setSchoolData] = useLocalStorage('schoolData', {
                schoolName: '',
                headmasterName: '',
                headmasterNip: '',
                teacherName: '',
                teacherNip: '',
                semester: '',
                academicYear: '',
                city: ''
            });
            const [editingJournal, setEditingJournal] = React.useState(null);
            const [isMobileMenuOpen, setIsMobileMenuOpen] = React.useState(false);

            const handleLogin = () => {
                setIsAuthenticated(true);
            };
            
            const handleLogout = () => {
                setIsAuthenticated(false);
            };

            if (!isAuthenticated) {
                return <LoginPage onLogin={handleLogin} credentials={credentials} />;
            }

            const addJournal = (journal) => {
                const newJournals = [...journals, { ...journal, id: Date.now() }];
                setJournals(newJournals.sort((a, b) => new Date(b.date) - new Date(a.date)));
                setPage('log');
            };

            const updateJournal = (updatedJournal) => {
                const newJournals = journals.map(j => j.id === updatedJournal.id ? updatedJournal : j);
                setJournals(newJournals.sort((a, b) => new Date(b.date) - new Date(a.date)));
                setEditingJournal(null);
                setPage('log');
            };

            const deleteJournal = (id) => {
                if (window.confirm('Apakah Anda yakin ingin menghapus jurnal ini?')) {
                    setJournals(journals.filter(j => j.id !== id));
                }
            };

            const handleEdit = (journal) => {
                setEditingJournal(journal);
                setPage('form');
            };

            const renderPage = () => {
                switch (page) {
                    case 'dashboard':
                        return <Dashboard journals={journals} setPage={setPage} />;
                    case 'form':
                        return <JournalForm 
                                    addJournal={addJournal} 
                                    updateJournal={updateJournal}
                                    editingJournal={editingJournal}
                                    setEditingJournal={setEditingJournal}
                                    setPage={setPage} />;
                    case 'log':
                        return <JournalLog journals={journals} onEdit={handleEdit} onDelete={deleteJournal} />;
                    case 'students':
                        return <StudentDatabase students={students} setStudents={setStudents} />;
                    case 'school-data':
                        return <SchoolDataPage schoolData={schoolData} setSchoolData={setSchoolData} />;
                    case 'account-settings':
                        return <AccountSettingsPage credentials={credentials} setCredentials={setCredentials} />;
                    case 'report':
                        return <ReportPage journals={journals} schoolData={schoolData} />;
                    default:
                        return <Dashboard journals={journals} setPage={setPage} />;
                }
            };
            
            return (
                <div className="md:flex md:min-h-screen">
                    {/* Sidebar for Desktop */}
                    <nav className="hidden md:flex md:flex-col md:w-64 bg-white p-4 justify-between shadow-lg border-r border-gray-200">
                        <div>
                            <h1 className="text-xl font-bold text-blue-600 mb-2">JUMADI</h1>
                            <p className="text-xs text-gray-500 mb-8">Jurnal Mengajar Digital</p>
                            <ul className="space-y-2">
                                <NavItem icon={icons.home} label="Dasbor" active={page === 'dashboard'} onClick={() => setPage('dashboard')} />
                                <NavItem icon={icons.plus} label="Jurnal Baru" active={page === 'form'} onClick={() => { setEditingJournal(null); setPage('form'); }} />
                                <NavItem icon={icons.book} label="Riwayat Jurnal" active={page === 'log'} onClick={() => setPage('log')} />
                                <NavItem icon={icons.users} label="Database Siswa" active={page === 'students'} onClick={() => setPage('students')} />
                                <NavItem icon={icons.school} label="Data Sekolah" active={page === 'school-data'} onClick={() => setPage('school-data')} />
                                <NavItem icon={icons.fileText} label="Laporan" active={page === 'report'} onClick={() => setPage('report')} />
                                <NavItem icon={icons.settings} label="Pengaturan Akun" active={page === 'account-settings'} onClick={() => setPage('account-settings')} />
                            </ul>
                        </div>
                        <div className="text-center">
                            <div className="text-xs text-gray-400 mb-4">
                                <p>App Developer by</p>
                                <p className="font-semibold">Agung Kurniawan, S.Pd.</p>
                            </div>
                            <button onClick={handleLogout} className="w-full flex items-center justify-center space-x-2 p-3 rounded-lg bg-red-50 hover:bg-red-100 text-red-600 font-semibold transition-colors">
                                {icons.logout}
                                <span>Keluar Aplikasi</span>
                            </button>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="flex-1 p-4 sm:p-6 lg:p-8 bg-gray-50 pb-24 md:pb-8">
                        {renderPage()}
                    </main>

                    {/* Bottom Navigation for Mobile */}
                    <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-t-lg border-t border-gray-200 z-50">
                        <ul className="flex justify-around items-center h-16">
                            <NavItem icon={icons.home} label="Dasbor" active={page === 'dashboard'} onClick={() => setPage('dashboard')} isMobile={true} />
                            <NavItem icon={icons.book} label="Riwayat" active={page === 'log'} onClick={() => setPage('log')} isMobile={true} />
                            <li className="relative -top-6">
                                <button onClick={() => { setEditingJournal(null); setPage('form'); }} className="w-16 h-16 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg transform hover:scale-110 transition-transform">
                                    {React.cloneElement(icons.plus, {width: 32, height: 32})}
                                </button>
                            </li>
                            <NavItem icon={icons.fileText} label="Laporan" active={page === 'report'} onClick={() => setPage('report')} isMobile={true} />
                            <NavItem icon={icons.settings} label="Menu" active={page === 'account-settings' || page === 'school-data' || page === 'students'} onClick={() => setIsMobileMenuOpen(true)} isMobile={true} />
                        </ul>
                    </nav>
                    {isMobileMenuOpen && <MobileMenuModal 
                        onClose={() => setIsMobileMenuOpen(false)}
                        setPage={setPage}
                        onLogout={handleLogout}
                    />}
                </div>
            );
        }

        function LoginPage({ onLogin, credentials }) {
            const [username, setUsername] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [error, setError] = React.useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (username === credentials.username && password === credentials.password) {
                    onLogin();
                } else {
                    setError('Username atau password salah!');
                }
            };

            return (
                <div className="min-h-screen bg-gray-100 flex flex-col justify-center items-center p-4">
                    <div className="w-full max-w-md">
                        <div className="bg-white shadow-xl rounded-2xl p-8">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-blue-600">JUMADI</h1>
                                <p className="text-gray-500">Aplikasi Jurnal Mengajar Digital</p>
                            </div>
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                    <input 
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input 
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                                {error && <p className="text-red-500 text-sm text-center">{error}</p>}
                                <button type="submit" className="w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition">
                                    Login
                                </button>
                            </form>
                        </div>
                    </div>
                    <div className="text-center mt-8 text-gray-500 text-sm">
                        <p>App Developer by</p>
                        <p className="font-semibold">Agung Kurniawan, S.Pd.</p>
                    </div>
                </div>
            );
        }

        function MobileMenuModal({ onClose, setPage, onLogout }) {
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex flex-col justify-end" onClick={onClose}>
                    <div className="bg-white rounded-t-2xl p-4" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-center items-center mb-4">
                            <div className="w-10 h-1 bg-gray-300 rounded-full"></div>
                        </div>
                        <ul className="space-y-2">
                            <li><button onClick={() => { setPage('students'); onClose(); }} className="w-full text-left flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                                {icons.users} <span>Database Siswa</span>
                            </button></li>
                            <li><button onClick={() => { setPage('school-data'); onClose(); }} className="w-full text-left flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                                {icons.school} <span>Data Sekolah</span>
                            </button></li>
                            <li><button onClick={() => { setPage('account-settings'); onClose(); }} className="w-full text-left flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                                {icons.settings} <span>Pengaturan Akun</span>
                            </button></li>
                        </ul>
                        <div className="border-t my-4"></div>
                        <button onClick={onLogout} className="w-full flex items-center justify-center space-x-2 p-3 rounded-lg bg-red-50 hover:bg-red-100 text-red-600 font-semibold transition-colors">
                            {icons.logout}
                            <span>Keluar Aplikasi</span>
                        </button>
                    </div>
                </div>
            );
        }


        function NavItem({ icon, label, active, onClick, isMobile = false }) {
            if (isMobile) {
                return (
                    <li>
                        <a href="#" onClick={onClick} className={`flex flex-col items-center justify-center w-16 text-center transition-colors duration-200 ${active ? 'text-blue-600' : 'text-gray-500 hover:text-blue-500'}`}>
                            {icon}
                            <span className="text-xs mt-1">{label}</span>
                        </a>
                    </li>
                );
            }
            return (
                <li>
                    <a href="#" onClick={onClick} className={`flex items-center space-x-3 p-3 rounded-lg transition-all duration-200 ${active ? 'bg-blue-50 text-blue-600 font-semibold' : 'text-gray-600 hover:bg-gray-100'}`}>
                        {icon}
                        <span className="hidden md:inline">{label}</span>
                    </a>
                </li>
            );
        }

        // Komponen Dasbor
        function Dashboard({ journals, setPage }) {
            const recentJournals = journals.slice(0, 3);
            return (
                <div>
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Selamat Datang!</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div 
                            onClick={() => setPage('form')}
                            className="bg-blue-500 text-white p-6 rounded-xl shadow-lg hover:bg-blue-600 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center text-center">
                            <div className="mb-4">{React.cloneElement(icons.plus, { width: 48, height: 48 })}</div>
                            <h3 className="text-xl font-semibold">Buat Jurnal Baru</h3>
                            <p className="mt-1 text-blue-100">Mulai catat kegiatan mengajar hari ini.</p>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-md">
                            <h3 className="text-lg font-semibold text-gray-700">Total Jurnal</h3>
                            <p className="text-4xl font-bold text-gray-900 mt-2">{journals.length}</p>
                            <p className="text-sm text-gray-500 mt-1">entri telah dibuat</p>
                        </div>
                         <div className="bg-white p-6 rounded-xl shadow-md">
                            <h3 className="text-lg font-semibold text-gray-700">Jurnal Terakhir</h3>
                            <p className="text-2xl font-bold text-gray-900 mt-2">{journals.length > 0 ? new Date(journals[0].date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) : 'Belum ada'}</p>
                            <p className="text-sm text-gray-500 mt-1">tanggal entri terakhir</p>
                        </div>
                    </div>

                    <div className="mt-10">
                        <h3 className="text-2xl font-bold text-gray-800 mb-4">Jurnal Terbaru</h3>
                        {recentJournals.length > 0 ? (
                            <div className="space-y-4">
                                {recentJournals.map(journal => (
                                    <div key={journal.id} className="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                                        <p className="font-semibold text-gray-800">{new Date(journal.date).toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long' })} - Kelas {journal.class}</p>
                                        <p className="text-sm text-gray-600 mt-1 truncate">{journal.objectives}</p>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <p className="text-gray-500 text-center py-8 bg-white rounded-lg">Belum ada jurnal yang dibuat.</p>
                        )}
                    </div>
                </div>
            );
        }

        // Komponen Form Jurnal
        function JournalForm({ addJournal, updateJournal, editingJournal, setEditingJournal, setPage }) {
            const initialFormState = {
                date: new Date().toISOString().split('T')[0],
                class: '',
                theme: '',
                subject: '',
                mainMaterial: '',
                objectives: '',
                processNotes: '',
                atmosphere: 'Cukup Kondusif',
                fastLearners: '',
                slowLearners: '',
                absentStudents: '',
                absentReason: '',
                specialNotes: '',
                reflection: '',
                followUp: ''
            };

            const [formData, setFormData] = React.useState(initialFormState);

            React.useEffect(() => {
                if (editingJournal) {
                    setFormData(editingJournal);
                } else {
                    setFormData(initialFormState);
                }
            }, [editingJournal]);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingJournal) {
                    updateJournal(formData);
                } else {
                    addJournal(formData);
                }
                setFormData(initialFormState);
                setEditingJournal(null);
            };
            
            return (
                <div className="bg-white p-6 md:p-8 rounded-xl shadow-lg max-w-4xl mx-auto">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">{editingJournal ? 'Edit Jurnal' : 'Buat Jurnal Harian Baru'}</h2>
                    <form onSubmit={handleSubmit} className="space-y-6">
                        {/* Bagian Informasi Umum */}
                        <fieldset className="border p-4 rounded-md">
                            <legend className="text-lg font-medium text-gray-700 px-2">Informasi Umum</legend>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                <FormInput label="Tanggal Mengajar" type="date" name="date" value={formData.date} onChange={handleChange} required />
                                <FormInput label="Kelas" type="text" name="class" value={formData.class} onChange={handleChange} placeholder="Contoh: IV-A" required />
                                <FormInput label="Tema/Subtema/PB" type="text" name="theme" value={formData.theme} onChange={handleChange} placeholder="Tema 1 / Subtema 1 / PB 2" />
                                <FormInput label="Mata Pelajaran" type="text" name="subject" value={formData.subject} onChange={handleChange} placeholder="Contoh: Matematika" />
                                <div className="md:col-span-2">
                                  <FormTextarea label="Materi Pokok" name="mainMaterial" value={formData.mainMaterial} onChange={handleChange} rows="2" placeholder="Contoh: Manfaat energi matahari" />
                                </div>
                            </div>
                        </fieldset>
                        
                        {/* Bagian Inti Pembelajaran */}
                        <fieldset className="border p-4 rounded-md">
                            <legend className="text-lg font-medium text-gray-700 px-2">Detail Pembelajaran</legend>
                            <div className="space-y-4 mt-4">
                                <FormTextarea label="Tujuan Pembelajaran Hari Ini" name="objectives" value={formData.objectives} onChange={handleChange} rows="3" placeholder="Siswa mampu..." required />
                                <FormTextarea label="Catatan Proses Pembelajaran" name="processNotes" value={formData.processNotes} onChange={handleChange} rows="4" placeholder="Apa yang berjalan baik/kurang baik? Momen penting?" />
                            </div>
                        </fieldset>
                        
                        {/* Bagian Penilaian dan Siswa */}
                        <fieldset className="border p-4 rounded-md">
                            <legend className="text-lg font-medium text-gray-700 px-2">Penilaian & Catatan Siswa</legend>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                <FormSelect label="Suasana Kelas" name="atmosphere" value={formData.atmosphere} onChange={handleChange} options={['Sangat Kondusif', 'Cukup Kondusif', 'Kurang Kondusif']} />
                                <FormTextarea label="Siswa Cepat Paham (Pengayaan)" name="fastLearners" value={formData.fastLearners} onChange={handleChange} rows="2" placeholder="Tulis nama siswa dan catatannya" />
                                <FormTextarea label="Siswa Perlu Bimbingan (Remedial)" name="slowLearners" value={formData.slowLearners} onChange={handleChange} rows="2" placeholder="Tulis nama siswa dan kesulitannya" />
                                <FormInput label="Nama Siswa Tidak Hadir" name="absentStudents" value={formData.absentStudents} onChange={handleChange} placeholder="Contoh: Budi, Ani" />
                                <FormInput label="Keterangan Tidak Hadir (S,I,A)" name="absentReason" value={formData.absentReason} onChange={handleChange} placeholder="Contoh: Budi (S), Ani (I)" />
                                <div className="md:col-span-2">
                                  <FormTextarea label="Catatan Perilaku/Kejadian Spesial" name="specialNotes" value={formData.specialNotes} onChange={handleChange} rows="2" placeholder="Catatan khusus tentang perilaku siswa" />
                                </div>
                            </div>
                        </fieldset>

                        {/* Bagian Refleksi */}
                        <fieldset className="border p-4 rounded-md">
                            <legend className="text-lg font-medium text-gray-700 px-2">Refleksi & Tindak Lanjut</legend>
                            <div className="space-y-4 mt-4">
                               <FormTextarea label="Refleksi Diri Saya Sebagai Guru" name="reflection" value={formData.reflection} onChange={handleChange} rows="3" placeholder="Apa yang perlu saya perbaiki untuk selanjutnya?" />
                               <FormTextarea label="Rencana Tindak Lanjut" name="followUp" value={formData.followUp} onChange={handleChange} rows="3" placeholder="Apa yang akan saya lakukan pada pertemuan berikutnya?" />
                            </div>
                        </fieldset>

                        <div className="flex justify-end space-x-4">
                            <button type="button" onClick={() => { setEditingJournal(null); setPage('dashboard');}} className="px-6 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 transition">Batal</button>
                            <button type="submit" className="px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition font-semibold">{editingJournal ? 'Simpan Perubahan' : 'Simpan Jurnal'}</button>
                        </div>
                    </form>
                </div>
            );
        }

        // Komponen untuk Riwayat Jurnal
        function JournalLog({ journals, onEdit, onDelete }) {
            const [searchTerm, setSearchTerm] = React.useState('');
            const [selectedJournal, setSelectedJournal] = React.useState(null);

            const filteredJournals = journals.filter(j => 
                Object.values(j).some(val => 
                    String(val).toLowerCase().includes(searchTerm.toLowerCase())
                )
            );

            return (
                <div>
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Riwayat Jurnal Mengajar</h2>
                    <div className="relative mb-6">
                        <input 
                            type="text"
                            placeholder="Cari jurnal (berdasarkan kata kunci, tanggal, kelas...)"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            className="w-full p-3 pl-10 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
                        />
                        <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                            {icons.search}
                        </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div className="space-y-2 p-2">
                        {filteredJournals.length > 0 ? filteredJournals.map(journal => (
                            <div key={journal.id} className="p-4 rounded-lg hover:bg-gray-50 transition-colors duration-200 flex justify-between items-center">
                                <div>
                                    <p className="font-bold text-lg text-gray-800">
                                        {new Date(journal.date).toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}
                                    </p>
                                    <p className="text-gray-600">Kelas {journal.class} - {journal.theme}</p>
                                </div>
                                <div className="flex items-center space-x-2">
                                    <button onClick={() => setSelectedJournal(journal)} className="text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-100">Lihat Detail</button>
                                    <button onClick={() => onEdit(journal)} className="text-green-600 hover:text-green-800 p-2 rounded-full hover:bg-green-100">{icons.edit}</button>
                                    <button onClick={() => onDelete(journal.id)} className="text-red-600 hover:text-red-800 p-2 rounded-full hover:bg-red-100">{icons.trash}</button>
                                </div>
                            </div>
                        )) : (
                            <p className="text-center text-gray-500 p-8">Tidak ada jurnal yang cocok dengan pencarian Anda.</p>
                        )}
                        </div>
                    </div>
                    {selectedJournal && <JournalDetailModal journal={selectedJournal} onClose={() => setSelectedJournal(null)} />}
                </div>
            );
        }
        
        // Komponen Modal Detail Jurnal
        function JournalDetailModal({ journal, onClose }) {
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h3 className="text-2xl font-bold text-gray-800">Detail Jurnal</h3>
                                <p className="text-gray-600">{new Date(journal.date).toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })} - Kelas {journal.class}</p>
                            </div>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-800">{icons.x}</button>
                        </div>
                        <div className="space-y-4 text-gray-700">
                            <DetailSection title="Tema/Subtema" content={journal.theme} />
                            <DetailSection title="Mata Pelajaran" content={journal.subject} />
                            <DetailSection title="Materi Pokok" content={journal.mainMaterial} />
                            <DetailSection title="Tujuan Pembelajaran" content={journal.objectives} />
                            <DetailSection title="Catatan Proses Pembelajaran" content={journal.processNotes} />
                            <DetailSection title="Suasana Kelas" content={journal.atmosphere} />
                            <DetailSection title="Siswa Cepat Paham (Pengayaan)" content={journal.fastLearners} />
                            <DetailSection title="Siswa Perlu Bimbingan (Remedial)" content={journal.slowLearners} />
                            <DetailSection title="Siswa Tidak Hadir" content={journal.absentStudents} />
                            <DetailSection title="Keterangan Tidak Hadir" content={journal.absentReason} />
                            <DetailSection title="Catatan Perilaku/Kejadian Spesial" content={journal.specialNotes} />
                            <DetailSection title="Refleksi Guru" content={journal.reflection} />
                            <DetailSection title="Rencana Tindak Lanjut" content={journal.followUp} />
                        </div>
                    </div>
                </div>
            );
        }

        function DetailSection({ title, content }) {
            if (!content || content.trim() === '') return null;
            return (
                <div>
                    <h4 className="font-semibold text-gray-800 border-b pb-1 mb-2">{title}</h4>
                    <p className="whitespace-pre-wrap">{content}</p>
                </div>
            );
        }

        // Komponen Database Siswa
        function StudentDatabase({ students, setStudents }) {
            const [newStudentName, setNewStudentName] = React.useState('');
            const [editingStudent, setEditingStudent] = React.useState(null);
            const fileInputRef = React.useRef(null);

            const addStudent = () => {
                if (newStudentName.trim() === '') return;
                setStudents(prev => [...prev, { id: Date.now(), name: newStudentName.trim(), notes: '' }]);
                setNewStudentName('');
            };

            const deleteStudent = (id) => {
                if (window.confirm('Yakin ingin menghapus data siswa ini? Semua catatannya akan hilang.')) {
                    setStudents(students.filter(s => s.id !== id));
                }
            };
            
            const openEditModal = (student) => {
                setEditingStudent(student);
            };

            const saveStudentNotes = (id, notes) => {
                setStudents(students.map(s => s.id === id ? { ...s, notes } : s));
                setEditingStudent(null);
            };
            
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = new Uint8Array(event.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                        const existingNames = new Set(students.map(s => s.name.toLowerCase()));
                        let importedCount = 0;

                        const newStudents = jsonData
                            .map(row => row[0]) // Ambil nama dari kolom pertama
                            .filter(name => name && typeof name === 'string' && name.trim() !== '')
                            .filter(name => !existingNames.has(name.trim().toLowerCase()))
                            .map(name => {
                                importedCount++;
                                existingNames.add(name.trim().toLowerCase()); // Hindari duplikat dari file yg sama
                                return { id: Date.now() + Math.random(), name: name.trim(), notes: '' };
                            });

                        if (newStudents.length > 0) {
                            setStudents(prev => [...prev, ...newStudents]);
                        }
                        alert(`${importedCount} siswa berhasil diimpor. ${jsonData.length - importedCount} siswa sudah ada atau data tidak valid.`);
                    } catch (error) {
                        console.error("Error reading Excel file:", error);
                        alert("Gagal membaca file Excel. Pastikan format file benar (.xlsx) dan kolom pertama berisi nama siswa.");
                    } finally {
                        // Reset input file agar bisa upload file yang sama lagi
                        if(fileInputRef.current) {
                            fileInputRef.current.value = "";
                        }
                    }
                };
                reader.readAsArrayBuffer(file);
            };

            return (
                <div>
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Database Siswa</h2>
                    <div className="bg-white p-6 rounded-xl shadow-lg mb-6">
                        <h3 className="text-xl font-semibold mb-4">Tambah Siswa</h3>
                        <div className="flex flex-wrap gap-2">
                            <input
                                type="text"
                                value={newStudentName}
                                onChange={(e) => setNewStudentName(e.target.value)}
                                placeholder="Masukkan nama lengkap siswa"
                                className="flex-grow p-2 border rounded-lg"
                            />
                            <button onClick={addStudent} className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">Tambah Manual</button>
                            <label className="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold cursor-pointer">
                                Impor dari Excel (.xlsx)
                                <input
                                    type="file"
                                    className="hidden"
                                    accept=".xlsx, .xls"
                                    ref={fileInputRef}
                                    onChange={handleFileUpload}
                                />
                            </label>
                        </div>
                         <p className="text-xs text-gray-500 mt-2">Untuk impor, pastikan file Excel berisi nama siswa di kolom pertama (A).</p>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h3 className="text-xl font-semibold mb-4">Daftar Siswa</h3>
                        <div className="space-y-3">
                            {students.length > 0 ? students.sort((a,b) => a.name.localeCompare(b.name)).map(student => (
                                <div key={student.id} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <p className="font-medium text-gray-800">{student.name}</p>
                                    <div className="flex items-center space-x-2">
                                        <button onClick={() => openEditModal(student)} className="text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-100">Lihat/Edit Catatan</button>
                                        <button onClick={() => deleteStudent(student.id)} className="text-red-600 hover:text-red-800 p-2 rounded-full hover:bg-red-100">{icons.trash}</button>
                                    </div>
                                </div>
                            )) : <p className="text-center text-gray-500 py-4">Belum ada siswa yang ditambahkan.</p>}
                        </div>
                    </div>
                    {editingStudent && <StudentNoteModal student={editingStudent} onSave={saveStudentNotes} onClose={() => setEditingStudent(null)} />}
                </div>
            );
        }
        
        // Komponen Modal Catatan Siswa
        function StudentNoteModal({ student, onSave, onClose }) {
            const [notes, setNotes] = React.useState(student.notes);
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <h3 className="text-2xl font-bold text-gray-800 mb-4">Catatan untuk {student.name}</h3>
                        <textarea
                            value={notes}
                            onChange={(e) => setNotes(e.target.value)}
                            rows="10"
                            className="w-full p-2 border rounded-lg"
                            placeholder="Tulis catatan perkembangan akademik, perilaku, kekuatan, atau area yang perlu ditingkatkan..."
                        ></textarea>
                        <div className="flex justify-end space-x-4 mt-4">
                            <button onClick={onClose} className="px-6 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300">Batal</button>
                            <button onClick={() => onSave(student.id, notes)} className="px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-semibold">Simpan Catatan</button>
                        </div>
                    </div>
                </div>
            );
        }

        // Komponen Halaman Data Sekolah
        function SchoolDataPage({ schoolData, setSchoolData }) {
            const [formData, setFormData] = React.useState(schoolData);
            const [isSaved, setIsSaved] = React.useState(false);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                setSchoolData(formData);
                setIsSaved(true);
                setTimeout(() => setIsSaved(false), 3000); // Pesan hilang setelah 3 detik
            };

            return (
                <div className="bg-white p-8 rounded-xl shadow-lg max-w-4xl mx-auto">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Data Sekolah & Guru</h2>
                    <form onSubmit={handleSubmit} className="space-y-6">
                        <FormInput label="Nama Sekolah" name="schoolName" value={formData.schoolName} onChange={handleChange} placeholder="Contoh: SD Negeri Cemerlang 1" />
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <FormInput label="Semester" name="semester" value={formData.semester} onChange={handleChange} placeholder="Contoh: Ganjil" />
                            <FormInput label="Tahun Ajaran" name="academicYear" value={formData.academicYear} onChange={handleChange} placeholder="Contoh: 2024/2025" />
                        </div>
                        <FormInput label="Kota/Kabupaten (untuk Laporan)" name="city" value={formData.city} onChange={handleChange} placeholder="Contoh: Semarang" />
                        <fieldset className="border p-4 rounded-md">
                            <legend className="text-lg font-medium text-gray-700 px-2">Data Kepala Sekolah</legend>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                <FormInput label="Nama Kepala Sekolah" name="headmasterName" value={formData.headmasterName} onChange={handleChange} />
                                <FormInput label="NIP Kepala Sekolah" name="headmasterNip" value={formData.headmasterNip} onChange={handleChange} />
                            </div>
                        </fieldset>
                        <fieldset className="border p-4 rounded-md">
                            <legend className="text-lg font-medium text-gray-700 px-2">Data Guru</legend>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                <FormInput label="Nama Guru" name="teacherName" value={formData.teacherName} onChange={handleChange} />
                                <FormInput label="NIP Guru" name="teacherNip" value={formData.teacherNip} onChange={handleChange} />
                            </div>
                        </fieldset>
                        <div className="flex justify-end items-center space-x-4">
                            {isSaved && <p className="text-green-600 font-semibold">Data berhasil disimpan!</p>}
                            <button type="submit" className="px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition font-semibold">Simpan Data</button>
                        </div>
                    </form>
                </div>
            );
        }

        // Komponen Halaman Pengaturan Akun
        function AccountSettingsPage({ credentials, setCredentials }) {
            const [formData, setFormData] = React.useState({
                currentUsername: '',
                currentPassword: '',
                newUsername: '',
                newPassword: '',
                confirmPassword: ''
            });
            const [message, setMessage] = React.useState({ type: '', text: '' });

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                setMessage({ type: '', text: '' });

                if (formData.currentUsername !== credentials.username || formData.currentPassword !== credentials.password) {
                    setMessage({ type: 'error', text: 'Username atau password saat ini salah.' });
                    return;
                }
                if (!formData.newUsername.trim() || !formData.newPassword.trim()) {
                    setMessage({ type: 'error', text: 'Username dan password baru tidak boleh kosong.' });
                    return;
                }
                if (formData.newPassword !== formData.confirmPassword) {
                    setMessage({ type: 'error', text: 'Password baru tidak cocok.' });
                    return;
                }

                setCredentials({
                    username: formData.newUsername,
                    password: formData.newPassword
                });
                setMessage({ type: 'success', text: 'Akun berhasil diperbarui! Silakan login kembali saat sesi berikutnya.' });
                setFormData({ currentUsername: '', currentPassword: '', newUsername: '', newPassword: '', confirmPassword: '' });
            };

            return (
                 <div className="bg-white p-8 rounded-xl shadow-lg max-w-2xl mx-auto">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Pengaturan Akun</h2>
                    <form onSubmit={handleSubmit} className="space-y-6">
                        <fieldset className="border p-4 rounded-md">
                            <legend className="text-lg font-medium text-gray-700 px-2">Verifikasi Akun Saat Ini</legend>
                            <div className="space-y-4 mt-4">
                                <FormInput label="Username Saat Ini" name="currentUsername" type="text" value={formData.currentUsername} onChange={handleChange} required />
                                <FormInput label="Password Saat Ini" name="currentPassword" type="password" value={formData.currentPassword} onChange={handleChange} required />
                            </div>
                        </fieldset>
                        <fieldset className="border p-4 rounded-md">
                            <legend className="text-lg font-medium text-gray-700 px-2">Akun Baru</legend>
                            <div className="space-y-4 mt-4">
                                <FormInput label="Username Baru" name="newUsername" type="text" value={formData.newUsername} onChange={handleChange} required />
                                <FormInput label="Password Baru" name="newPassword" type="password" value={formData.newPassword} onChange={handleChange} required />
                                <FormInput label="Konfirmasi Password Baru" name="confirmPassword" type="password" value={formData.confirmPassword} onChange={handleChange} required />
                            </div>
                        </fieldset>
                        <div className="flex justify-end items-center space-x-4">
                            {message.text && (
                                <p className={`${message.type === 'success' ? 'text-green-600' : 'text-red-600'} font-semibold`}>{message.text}</p>
                            )}
                            <button type="submit" className="px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition font-semibold">Simpan Perubahan</button>
                        </div>
                    </form>
                </div>
            );
        }

        // Komponen Halaman Laporan
        function ReportPage({ journals, schoolData }) {
            
            const formatDateForReport = (dateStr) => {
                const date = new Date(dateStr);
                const dayName = date.toLocaleDateString('id-ID', { weekday: 'long' });
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${dayName}, ${day}/${month}/${year}`;
            };

            const generatePDFDoc = (journals) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'landscape' });
                
                doc.setFont("helvetica", "bold");
                doc.text("JURNAL PELAKSANAAN PEMBELAJARAN HARIAN", doc.internal.pageSize.getWidth() / 2, 15, { align: 'center' });
                
                doc.setFont("helvetica", "normal");
                doc.setFontSize(10);
                
                const reportClass = journals.length > 0 ? journals[0].class : '';

                const headerY = 25;
                doc.text(`Nama Guru`, 14, headerY);
                doc.text(`: ${schoolData.teacherName || ''}`, 50, headerY);
                doc.text(`Sekolah`, doc.internal.pageSize.getWidth() / 2, headerY);
                doc.text(`: ${schoolData.schoolName || ''}`, doc.internal.pageSize.getWidth() / 2 + 36, headerY);
                
                doc.text(`Kelas/Semester`, 14, headerY + 5);
                doc.text(`: ${reportClass} / ${schoolData.semester || ''}`, 50, headerY + 5);
                doc.text(`Tahun Ajaran`, doc.internal.pageSize.getWidth() / 2, headerY + 5);
                doc.text(`: ${schoolData.academicYear || ''}`, doc.internal.pageSize.getWidth() / 2 + 36, headerY + 5);


                const tableColumn = ["Hari, Tanggal", "Tema", "Mata Pelajaran", "Tujuan Pembelajaran", "Materi Pokok", "Siswa Tidak Hadir", "Ket.", "Catatan Khusus", "Refleksi Guru"];
                const tableRows = [];

                journals.forEach(journal => {
                    const journalData = [
                        formatDateForReport(journal.date),
                        journal.theme || '',
                        journal.subject || '',
                        journal.objectives || '',
                        journal.mainMaterial || '',
                        journal.absentStudents || '',
                        journal.absentReason || '',
                        journal.specialNotes || '',
                        journal.reflection || ''
                    ];
                    tableRows.push(journalData);
                });

                doc.autoTable({
                    head: [tableColumn],
                    body: tableRows,
                    startY: headerY + 15,
                    theme: 'grid',
                    styles: { font: 'helvetica', fontSize: 8, cellPadding: 1.5 },
                    headStyles: { fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold', halign: 'center' },
                    columnStyles: {
                        0: { cellWidth: 30 },
                        1: { cellWidth: 30 },
                        2: { cellWidth: 25 },
                        3: { cellWidth: 40 },
                        4: { cellWidth: 35 },
                        5: { cellWidth: 30 },
                        6: { cellWidth: 10 },
                        7: { cellWidth: 40 },
                        8: { cellWidth: 'auto' }
                    }
                });

                const finalY = doc.lastAutoTable.finalY || doc.internal.pageSize.getHeight() - 40;
                let signatureY = finalY + 15;
                
                if (signatureY > doc.internal.pageSize.getHeight() - 35) {
                  doc.addPage();
                  signatureY = 20;
                }

                const today = new Date().toLocaleDateString('id-ID', {day: 'numeric', month: 'long', year: 'numeric'});
                const city = schoolData.city || ".........................";

                doc.setFontSize(10);
                doc.text(`Mengetahui,`, 20, signatureY);
                doc.text(`Kepala Sekolah`, 20, signatureY + 5);

                doc.text(`${city}, ${today}`, doc.internal.pageSize.getWidth() - 60, signatureY);
                doc.text(`Guru Kelas`, doc.internal.pageSize.getWidth() - 60, signatureY + 5);
                
                doc.setFont("helvetica", "bold");
                doc.text(schoolData.headmasterName || '.........................', 20, signatureY + 25);
                doc.text(schoolData.teacherName || '.........................', doc.internal.pageSize.getWidth() - 60, signatureY + 25);
                
                doc.setFont("helvetica", "normal");
                doc.text(`NIP. ${schoolData.headmasterNip || '.........................'}`, 20, signatureY + 30);
                doc.text(`NIP. ${schoolData.teacherNip || '.........................'}`, doc.internal.pageSize.getWidth() - 60, signatureY + 30);


                return doc;
            }

            const previewPDF = () => {
                if (journals.length === 0) {
                    alert("Tidak ada data jurnal untuk pratinjau.");
                    return;
                }
                const doc = generatePDFDoc(journals);
                doc.output('dataurlnewwindow');
            }

            const downloadPDF = () => {
                if (journals.length === 0) {
                    alert("Tidak ada data jurnal untuk diekspor.");
                    return;
                }
                const doc = generatePDFDoc(journals);
                doc.save(`Laporan_Jurnal_Mengajar_${new Date().toISOString().split('T')[0]}.pdf`);
            };

            return (
                <div>
                    <div className="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <h2 className="text-3xl font-bold text-gray-800">Laporan Pembelajaran</h2>
                        <div className="flex items-center space-x-2">
                            <button 
                                onClick={previewPDF}
                                className="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition flex items-center space-x-2"
                            >
                                {icons.eye}
                                <span>Pratinjau Laporan</span>
                            </button>
                            <button 
                                onClick={downloadPDF}
                                className="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition flex items-center space-x-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                <span>Download (PDF)</span>
                            </button>
                        </div>
                    </div>
                    <div className="bg-white p-4 rounded-xl shadow-lg mb-6">
                        <h3 className="font-semibold text-lg">Informasi Laporan</h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-2 text-sm">
                            <div><span className="font-medium text-gray-500">Nama Guru:</span> {schoolData.teacherName || '-'}</div>
                            <div><span className="font-medium text-gray-500">Sekolah:</span> {schoolData.schoolName || '-'}</div>
                            <div><span className="font-medium text-gray-500">Kelas/Semester:</span> {journals.length > 0 ? `${journals[0].class} / ${schoolData.semester}` : '-'}</div>
                            <div><span className="font-medium text-gray-500">Tahun Ajaran:</span> {schoolData.academicYear || '-'}</div>
                        </div>
                    </div>
                    <div className="bg-white rounded-xl shadow-lg overflow-x-auto">
                        <table className="w-full text-sm text-left text-gray-500">
                            <thead className="text-xs text-gray-700 uppercase bg-gray-100">
                                <tr>
                                    <th scope="col" className="px-6 py-3">Hari, Tanggal</th>
                                    <th scope="col" className="px-6 py-3">Tema</th>
                                    <th scope="col" className="px-6 py-3">Mapel</th>
                                    <th scope="col" className="px-6 py-3">Tujuan Pembelajaran</th>
                                    <th scope="col" className="px-6 py-3">Siswa Tdk Hadir</th>
                                    <th scope="col" className="px-6 py-3">Catatan Khusus</th>
                                    <th scope="col" className="px-6 py-3">Refleksi Guru</th>
                                </tr>
                            </thead>
                            <tbody>
                                {journals.length > 0 ? journals.map(j => (
                                    <tr key={j.id} className="bg-white border-b hover:bg-gray-50">
                                        <td className="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{formatDateForReport(j.date)}</td>
                                        <td className="px-6 py-4">{j.theme}</td>
                                        <td className="px-6 py-4">{j.subject}</td>
                                        <td className="px-6 py-4">{j.objectives}</td>
                                        <td className="px-6 py-4">{j.absentStudents} ({j.absentReason})</td>
                                        <td className="px-6 py-4">{j.specialNotes}</td>
                                        <td className="px-6 py-4">{j.reflection}</td>
                                    </tr>
                                )) : (
                                    <tr>
                                        <td colSpan="7" className="text-center py-8 text-gray-500">Belum ada data jurnal.</td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // Komponen Input Form yang bisa dipakai ulang
        const FormInput = ({ label, ...props }) => (
            <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
                <input {...props} className="w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
            </div>
        );

        const FormTextarea = ({ label, ...props }) => (
            <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
                <textarea {...props} className="w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
            </div>
        );
        
        const FormSelect = ({ label, options, ...props }) => (
            <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
                <select {...props} className="w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    {options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                </select>
            </div>
        );

        // Menggunakan API baru untuk React 18
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
